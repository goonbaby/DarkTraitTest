<!DOCTYPE html>
<html lang="th">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
   <title>Dark Trait Test - Go On BaBy</title>
   <style>
       @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap');
      
       :root {
           --safe-area-inset-top: env(safe-area-inset-top, 20px);
           --safe-area-inset-right: env(safe-area-inset-right, 20px);
           --safe-area-inset-bottom: env(safe-area-inset-bottom, 20px);
           --safe-area-inset-left: env(safe-area-inset-left, 20px);
       }


       * {
           margin: 0;
           padding: 0;
           box-sizing: border-box;
       }
      
       body {
           font-family: 'Kanit', sans-serif;
           background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 25%, #16213e 50%, #0f0f0f 100%);
           min-height: 100vh;
           color: white;
           overflow-x: hidden;
           position: relative;
           font-size: 16px;
           line-height: 1.6;
       }
      
       .bg-mystery {
           position: fixed;
           top: 0;
           left: 0;
           width: 100%;
           height: 100%;
           z-index: -1;
           opacity: 0.05;
       }
      
       .mystery-particle {
           position: absolute;
           background: radial-gradient(circle, #ff6b6b, #4ecdc4);
           border-radius: 50%;
           filter: blur(2px);
           animation: mysteryFloat 12s ease-in-out infinite;
           will-change: transform, opacity;
       }
      
       @keyframes mysteryFloat {
           0%, 100% { transform: translateY(0px) rotate(0deg); opacity: 0.3; }
           50% { transform: translateY(-50px) rotate(180deg); opacity: 0.5; }
       }
      
       .container {
           max-width: 900px;
           margin: 0 auto;
           padding-left: max(20px, var(--safe-area-inset-left));
           padding-right: max(20px, var(--safe-area-inset-right));
           padding-top: var(--safe-area-inset-top);
           padding-bottom: max(60px, var(--safe-area-inset-bottom));
       }
      
       .header {
           text-align: center;
           padding-top: 30px;
           margin-bottom: 30px;
           animation: darkReveal 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
       }
      
       @keyframes darkReveal {
           from { opacity: 0; transform: translateY(-30px) scale(0.9); }
           to { opacity: 1; transform: translateY(0) scale(1); }
       }
      
       .header h1 {
           font-size: clamp(2.2rem, 9vw, 2.8rem);
           font-weight: 700;
           margin-bottom: 16px;
           background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #ffd93d, #6c5ce7);
           -webkit-background-clip: text;
           -webkit-text-fill-color: transparent;
           background-clip: text;
           text-shadow: 0 0 15px rgba(255,107,107,0.4);
           letter-spacing: 1px;
           line-height: 1.2;
       }
      
       .main-card {
           background: rgba(0,0,0,0.7);
           backdrop-filter: blur(25px);
           -webkit-backdrop-filter: blur(25px);
           border: 1px solid rgba(255,255,255,0.1);
           border-radius: 24px;
           padding: 24px;
           box-shadow: 0 20px 50px rgba(0,0,0,0.6);
           animation: cardEmerge 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) 0.3s both;
           position: relative;
           overflow: hidden;
           will-change: transform, opacity;
       }
      
       @keyframes cardEmerge {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
       }


       .main-card::before {
           content: '';
           position: absolute;
           top: 0;
           left: 0;
           right: 0;
           height: 4px;
           background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #ffd93d, #6c5ce7, #ff6b6b);
           background-size: 200% 100%;
           animation: gradientShift 3s ease-in-out infinite;
       }


       @keyframes gradientShift {
           0% { background-position: 0% 50%; }
           50% { background-position: 100% 50%; }
           100% { background-position: 0% 50%; }
       }
      
       .start-section { text-align: center; }
       .start-icon { font-size: 3.5rem; margin-bottom: 16px; animation: pulseGlow 3s infinite; }
      
       @keyframes pulseGlow {
           0%, 100% { transform: scale(1); filter: drop-shadow(0 0 15px rgba(255,107,107,0.4)); }
           50% { transform: scale(1.05); filter: drop-shadow(0 0 25px rgba(78,205,196,0.6)); }
       }
      
       .start-text {
           font-size: 1.3rem;
           margin-bottom: 16px;
           font-weight: 600;
           color: #ffd93d;
           line-height: 1.3;
       }
      
       .start-description {
           font-size: 1rem;
           opacity: 0.9;
           margin-bottom: 24px;
           color: #e0e0e0;
           max-width: 400px;
           margin-left: auto;
           margin-right: auto;
           line-height: 1.7;
       }
              
       .btn { min-height: 48px; padding: 12px 24px; border: none; border-radius: 50px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease; font-family: 'Kanit', sans-serif; position: relative; overflow: hidden; text-transform: uppercase; letter-spacing: 1.5px; -webkit-tap-highlight-color: transparent; will-change: transform, box-shadow; }
       .btn-danger { background: linear-gradient(45deg, #ff6b6b, #ee5a52); color: white; box-shadow: 0 8px 20px rgba(255,107,107,0.3); }
       .btn-secondary { background: linear-gradient(45deg, #6c757d, #495057); color: white; box-shadow: 0 8px 20px rgba(108,117,125,0.3); }
       .btn:active { transform: translateY(2px); box-shadow: 0 4px 10px rgba(0,0,0,0.4); }
       .btn:disabled { opacity: 0.4; cursor: not-allowed; box-shadow: none !important; transform: none !important; }
      
       .quiz-section { display: none; }
       .progress-container { background: rgba(0,0,0,0.6); border-radius: 15px; height: 10px; margin-bottom: 16px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); }
       .progress-bar { height: 100%; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); border-radius: 15px; transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); width: 0%; will-change: width; }
       .progress-text { text-align: center; margin-bottom: 16px; font-size: 0.9rem; opacity: 0.8; }
      
       .question-card { background: rgba(0,0,0,0.4); border-radius: 20px; padding: 24px; animation: questionDarkSlide 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); will-change: transform, opacity; }
       @keyframes questionDarkSlide { from { opacity: 0; transform: translateX(50px); } to { opacity: 1; transform: translateX(0); } }
       @keyframes questionDarkFadeOut { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(-50px); } }
       .question-number { font-size: 0.9rem; opacity: 0.8; margin-bottom: 16px; color: #ffd93d; font-weight: 600; }
       .question-text { font-size: 1.1rem; font-weight: 500; margin-bottom: 24px; line-height: 1.5; }
      
       .answers-grid { display: flex; flex-direction: column; gap: 12px; }
       .answer-option { background: rgba(255,255,255,0.03); border: 2px solid rgba(255,255,255,0.1); border-radius: 15px; padding: 18px; min-height: 48px; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; position: relative; color: #e0e0e0; will-change: transform, box-shadow, border-color; line-height: 1.4; text-align: left;}
       .answer-option:hover { background: rgba(255,255,255,0.08); border-color: #4ecdc4; }
       .answer-option.selected { background: linear-gradient(135deg, rgba(255,107,107,0.2), rgba(78,205,196,0.2)); border-color: #ff6b6b; transform: scale(1.03); color: #ffffff; }
      
       .quiz-navigation { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-top: 24px; }
       .quiz-navigation .btn { font-size: 0.9rem; padding: 10px 20px; min-height: 44px; }


       .results-section { display: none; animation: resultsReveal 1s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
       @keyframes resultsReveal { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }


       .results-header { text-align: center; margin-bottom: 24px; }
       .results-header h2 { font-size: 1.8rem; color: #ffd93d; margin-bottom: 10px; line-height: 1.3; }
      
       .archetype-card { background: rgba(0,0,0,0.7); border: 2px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 24px; text-align: center; margin-bottom: 24px; position: relative; }
       .archetype-card.primary { border-color: #ff6b6b; box-shadow: 0 0 30px rgba(255,107,107,0.3); }
      
       .archetype-title { font-size: 1.6rem; font-weight: 700; margin-bottom: 5px; background: linear-gradient(45deg, #ff6b6b, #4ecdc4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; line-height: 1.3; }
       .archetype-classification { font-size: 1.1rem; font-weight: 500; color: #ffd93d; margin-bottom: 15px; }
       .archetype-subtitle { font-size: 1rem; opacity: 0.9; margin-bottom: 16px; font-style: italic; color: #e0e0e0; line-height: 1.4; }
      
       .archetype-description-section { margin-top: 20px; text-align: left; }
       .archetype-description-section h3 { font-size: 1.1rem; color: #ffd93d; margin-bottom: 10px; border-left: 3px solid #ffd93d; padding-left: 10px; }
       .archetype-description-section p { font-size: 1rem; max-width: 100%; margin: 0 auto 16px; line-height: 1.6; opacity: 0.9; }


       .call-to-action { margin-top: 24px; padding: 20px; background: rgba(255,217,61,0.1); border: 1px solid rgba(255,217,61,0.2); border-radius: 15px; }
       .call-to-action h3 { font-size: 1.2rem; line-height: 1.5; color: #fff; margin-bottom: 12px; }
       .call-to-action p { font-size: 1rem; line-height: 1.7; opacity:0.9; }
       .cta-highlight { color: #ffc107; font-weight: 700; }
       .cta-special { background: linear-gradient(45deg, #ff6b6b, #ffd93d); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }


       .power-bars-container { margin-top: 40px; padding: 20px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; display: flex; flex-direction: column; gap: 20px;}
       .power-bar-wrapper { opacity: 0; transform: translateX(-20px); animation: barFadeIn 0.5s ease-out forwards; }
       @keyframes barFadeIn { to { opacity: 1; transform: translateX(0); } }


       .power-bar-info { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 8px; font-size: 0.9rem; font-weight: 500; }
       .power-bar-label { display: flex; flex-direction: column; align-items: flex-start; }
       .power-bar-main-label { display: flex; align-items: center; gap: 8px; font-size: 1rem; font-weight: 600; }
       .power-bar-thai-name { font-size: 0.8rem; color: rgba(255,255,255,0.7); margin-left: 28px; margin-top: -4px; }
       .power-bar-value { color: #ffd93d; font-size: 1.1rem; font-weight: 600; }
       .power-bar-icon { font-size: 1.2rem; }


       .power-bar-bg { width: 100%; height: 12px; background-color: rgba(0,0,0,0.5); border-radius: 50px; border: 1px solid rgba(255,255,255,0.1); overflow: hidden; }
       .power-bar-fill { width: 0; height: 100%; border-radius: 50px; background: linear-gradient(90deg, #ff6b6b, #a29bfe, #4ecdc4); transition: width 1.2s cubic-bezier(0.25, 1, 0.5, 1); box-shadow: 0 0 10px rgba(255,107,107,0.5); }
      
       .restart-section { border-radius: 20px; padding: 24px; text-align: center; background: rgba(78,205,196,0.1); border: 1px solid rgba(78,205,196,0.2); margin-top: 50px; margin-bottom: 20px; }
       .restart-section h3 { font-size: 1.3rem; color: #4ecdc4; margin-bottom: 16px; line-height: 1.4; }
      
       .credit-footer {
           position: fixed;
           right: 20px;
           bottom: calc(15px + var(--safe-area-inset-bottom));
           font-size: 0.75rem;
           color: rgba(255, 255, 255, 0.4);
           font-family: 'Kanit', sans-serif;
           font-weight: 300;
           z-index: 100;
           pointer-events: none;
           text-shadow: 0 1px 3px rgba(0,0,0,0.5);
       }


       .disclaimer {
           text-align: center;
           font-size: 0.8rem;
           color: rgba(255, 255, 255, 0.7);
           line-height: 1.5;
           padding: 0 20px;
           margin-top: 30px;
       }


       /* --- Responsive Styles --- */
       @media (min-width: 768px) {
           body { font-size: 17px; }
           .container { padding: 40px; }
           .main-card { padding: 40px; border-radius: 30px;}
           .header h1 { font-size: 3rem; }
           .question-text { font-size: 1.3rem; } /* Font size for Tablet+ */
           .answer-option { padding: 20px 25px; font-size: 1.1rem; } /* Font size for Tablet+ */
           .results-header h2 { font-size: 2rem; }
           .archetype-title { font-size: 2rem; }
           .archetype-description-section p { font-size: 1.05rem; }
       }


   </style>
</head>
<body>
   <div class="bg-mystery" id="bgMystery"></div>
  
   <div class="container" id="container">
       <header class="header">
           <h1>Dark Trait Test</h1>
       </header>
      
       <main class="main-card" id="mainCard">
           <!-- Start Section -->
           <section class="start-section" id="startSection">
               <div class="start-icon">🎭</div>
               <div class="start-text">พร้อมที่จะเผชิญหน้ากับ<br>ด้านมืดในตัวคุณแล้วหรือยัง?</div>
               <div class="start-description">
                   แบบทดสอบนี้จะพาคุณดำดิ่งสู่จิตใต้สำนึก ผ่าน 12 สถานการณ์ที่บีบคั้น เพื่อค้นพบต้นแบบด้านมืดที่ขับเคลื่อนคุณอยู่เบื้องหลัง
               </div>
               <button class="btn btn-danger" id="startTestBtn">🚀 เริ่มการสำรวจ</button>
           </section>
          
           <!-- Quiz Section -->
           <section class="quiz-section" id="quizSection">
               <div class="progress-text" id="progressText"></div>
               <div class="progress-container">
                   <div class="progress-bar" id="progressBar"></div>
               </div>
              
               <div id="questionContainer">
                   <!-- Question will be injected here by JavaScript -->
               </div>
           </section>
          
           <!-- Results Section -->
           <section class="results-section" id="resultsSection">
               <div class="results-header">
                   <h2>ผลการวิเคราะห์ด้านมืดของคุณ</h2>
               </div>
               <div id="resultsContainer">
                   <!-- Top Archetype cards will be populated here -->
               </div>


               <div class="power-bars-container" id="powerBarsContainer">
                   <div class="results-header">
                       <h2>ระดับคะแนนด้านมืดของคุณ</h2>
                       <p style="opacity:0.8;">เปรียบเทียบคะแนนของ 6 ต้นแบบบุคลิกที่ซ่อนอยู่ในตัวคุณ</p>
                   </div>
                   <div id="powerBarsContent"></div>
               </div>


               <div class="restart-section" id="restartSection">
                    <h3>🔄 ต้องการวิเคราะห์อีกครั้งหรือไม่?</h3>
                    <button class="btn btn-danger" id="retakeBtn" style="background: linear-gradient(45deg, #4ecdc4, #3aa69d); box-shadow: 0 8px 20px rgba(78,205,196,0.3);">🎭 ทดสอบใหม่</button>
               </div>
           </section>
       </main>


       <footer class="disclaimer" id="disclaimerFooter">
            <!-- Disclaimer content will be injected here by JS -->
       </footer>
      
   </div>
  
   <div class="credit-footer">By Go On BaBy</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
   // --- DATA ---
   const archetypesData = {
       machiavellian: {
           name: "The Master Manipulator",
           thaiName: "นักเชิดใยระดับปรมาจารย์",
           scientificTerm: "Machiavellianism",
           icon: "🎭",
           quote: "คนอื่นอาจจะเล่นเกม แต่คุณคือคนที่ออกแบบเกม",
           description: "คนแบบคุณไม่ได้มองโลกเป็นแค่สถานที่ แต่เป็นกระดานหมากรุกที่ซับซ้อน คุณมีความสามารถพิเศษในการมองข้ามอารมณ์ที่ฉาบฉวย และมองเห็นโครงสร้างอำนาจและความปรารถนาที่ซ่อนอยู่ของคนอื่นได้อย่างทะลุปรุโปร่ง สำหรับคุณ ทุกการกระทำและการตัดสินใจคือการเดินหมากที่ผ่านการคำนวณมาอย่างดีเพื่อเป้าหมายในระยะยาว นี่ไม่ใช่ความชั่วร้าย แต่เป็นสภาวะการรับรู้ที่มองหา 'ประโยชน์ใช้สอย' (Utility) ในทุกสิ่ง",
           shadow: "เงามืดที่อันตรายที่สุดของคุณไม่ใช่การถูกจับได้ แต่คือ 'ความว่างเปล่า' ที่รออยู่บนบัลลังก์แห่งชัยชนะ การมองทุกคนเป็นเพียงเครื่องมืออาจทำให้คุณชนะในทุกเกม แต่ต้องลงเอยด้วยการอยู่คนเดียวในสนามที่ไร้ผู้คน ความสำเร็จที่ได้มาจากการหลอกใช้มักไม่ยั่งยืน และความหวาดระแวงว่าสักวันหนึ่ง 'หมาก' ที่คุณเคยควบคุมจะรู้ทัน คือยาพิษที่กัดกินคุณอย่างช้าๆ",
           unlock: "พรสวรรค์ของคุณคือการมองเห็นภาพรวมและวางกลยุทธ์ได้อย่างเหนือชั้น ศักยภาพสูงสุดของคุณจะถูกปลดล็อกเมื่อคุณเปลี่ยนจากการ 'ควบคุม' (Control) มาเป็นการ 'ชี้นำ' (Influence) ลองใช้ความสามารถในการอ่านเกมของคุณเพื่อสร้างสถานการณ์ที่ทุกฝ่ายได้ประโยชน์ (Win-Win) แทนที่จะมีผู้ชนะเพียงคนเดียว เมื่อคุณใช้ความสามารถนี้เพื่อสร้างทีมและนำทางผู้คนไปสู่เป้าหมายร่วมกัน คุณจะไม่ได้เป็นแค่นักเชิดใย แต่จะเป็น 'สถาปนิกผู้สร้างอนาคต' ที่ทุกคนยอมรับจากใจจริง"
       },
       narcissist: {
           name: "The Grandiose Self",
           thaiName: "ตัวตนผู้ยิ่งใหญ่",
           scientificTerm: "Narcissism",
           icon: "👑",
           quote: "ผมไม่ได้ต้องการเป็นที่หนึ่ง... แต่ผมคือที่หนึ่งอยู่แล้ว",
           description: "คนส่วนใหญ่มองว่าคุณหลงตัวเอง แต่ลึกลงไปกว่านั้น แก่นแท้ของคุณคือ 'ภาพลักษณ์' ที่คุณสร้างขึ้นมาอย่างประณีตเพื่อปกปิดความกลัวลึกๆ ว่าตัวเองอาจ 'ไม่ดีพอ' ดังนั้น คำชื่นชมจากภายนอกจึงไม่ใช่แค่สิ่งที่ทำให้คุณรู้สึกดี แต่มันคือ 'เครื่องยืนยัน' การมีอยู่ของตัวตนอันยิ่งใหญ่ที่คุณต้องการจะเป็น ความมั่นใจที่คุณแสดงออกมาคือเกราะป้องกันตัวตนที่เปราะบางที่สุดของคุณ",
           shadow: "จุดอ่อนที่สุดของคุณคือการที่คุณฝากคุณค่าทั้งหมดของตัวเองไว้ในสายตาของคนอื่น คำวิจารณ์เพียงเล็กน้อยจึงอาจให้ความรู้สึกเจ็บปวดรุนแรงเหมือนโลกถล่ม สิ่งนี้จะทำให้คุณสร้างกำแพงสูงขึ้นเรื่อยๆ จนไม่สามารถสร้างความสัมพันธ์ที่แท้จริงได้ และสุดท้ายอาจต้องเผชิญกับความรู้สึกโดดเดี่ยวที่ว่า 'ไม่มีใครเข้าใจฉันจริงๆ เลย'",
           unlock: "คุณค่าที่แท้จริงไม่ได้มาจากการแสวงหา แต่มาจากการสร้างขึ้นด้วยตัวเอง ลองเปลี่ยนจากการ 'เรียกร้องความสนใจ' มาเป็นการ 'มอบสิ่งที่มีคุณค่า' ให้กับผู้อื่น ใช้เสน่ห์และความสามารถในการนำเสนอของคุณเพื่อดึงศักยภาพของคนรอบข้างออกมา เมื่อคุณเรียนรู้ที่จะชื่นชมความสำเร็จของคนอื่นได้โดยไม่รู้สึกว่าแสงในตัวคุณลดลง เมื่อนั้นคุณจะพบกับความมั่นใจจากภายในที่ไม่ต้องพึ่งพาเสียงปรบมือจากใครอีกต่อไป"
       },
       psychopath: {
           name: "The Unfeeling Strategist",
           thaiName: "นักวางกลยุทธ์ผู้เย็นชา",
           scientificTerm: "Psychopathy",
           icon: "🧠",
           quote: "ความรู้สึกคือจุดอ่อน... และผมไม่มีจุดอ่อนนั้น",
           description: "คุณมีระบบปฏิบัติการในสมองที่แตกต่างจากคนทั่วไป ในขณะที่คนอื่นถูกรบกวนด้วย 'สัญญาณรบกวน' ที่เรียกว่าอารมณ์ คุณกลับสามารถมองเห็นข้อมูลดิบและตรรกะของสถานการณ์ได้อย่างชัดเจน ความเยือกเย็นของคุณไม่ใช่การเสแสร้ง แต่เป็นสภาวะพื้นฐานที่ทำให้คุณสามารถทำงานที่ต้องใช้สมาธิและความเด็ดขาดภายใต้ความกดดันมหาศาลได้ดีอย่างไม่น่าเชื่อ",
           shadow: "การตัดขาดจากอารมณ์อาจทำให้คุณเป็นนักแก้ปัญหาที่ไร้เทียมทาน แต่ก็อาจทำให้คุณเป็นเพียง 'ผู้ชม' ในชีวิตของตัวเอง คุณอาจเข้าใจคอนเซปต์ของความรัก ความสุข หรือความผูกพัน แต่ไม่เคย 'รู้สึก' ถึงมันจริงๆ สิ่งนี้อาจนำไปสู่ความรู้สึกเบื่อหน่ายที่ลึกล้ำ และการแสวงหาความตื่นเต้นที่เสี่ยงและอันตรายมากขึ้นเรื่อยๆ เพื่อให้ 'รู้สึก' ถึงอะไรบางอย่าง",
           unlock: "พรสวรรค์ของคุณคือ 'ความชัดเจนในความคิด' ที่ไม่ถูกบดบังด้วยอารมณ์ มันคือเครื่องมือที่ทรงพลังที่สุดในการแก้ปัญหาที่คนส่วนใหญ่ยอมแพ้ ลองเปลี่ยนจากการ 'ไม่รู้สึก' เป็นการ 'ใช้ความนิ่งให้เป็นประโยชน์' ในสถานการณ์ที่โกลาหลที่สุด คุณคือสมอที่มั่นคงของเรือที่กำลังเจอพายุ ลองใช้ความสามารถนี้กับอาชีพที่ต้องอาศัยความเด็ดขาดและความแม่นยำสูงสุด เช่น ศัลยแพทย์ นักบิน หรือผู้บริหารในภาวะวิกฤต แล้วคุณจะเป็นผู้สร้างระเบียบจากความวุ่นวาย"
       },
       sociopath: {
           name: "The Impulsive Rebel",
           thaiName: "กบฏผู้หุนหัน",
           scientificTerm: "Sociopathy",
           icon: "🔥",
           quote: "กฎมีไว้ให้คนอื่นทำตาม ไม่ใช่ผม",
           description: "คุณไม่ได้ต่อต้านกฎเกณฑ์เพียงเพราะอยากทำลาย แต่คุณมองเห็นว่ากฎเกณฑ์และบรรทัดฐานของสังคมหลายอย่างนั้น 'ไม่มีประสิทธิภาพ' และเป็นเพียงสิ่งที่คนอ่อนแอสร้างขึ้นเพื่อจำกัดศักยภาพของคนกล้า คุณเชื่อมั่นในสัญชาตญาณและแรงผลักดันของตัวเองอย่างแรงกล้า การตัดสินใจที่รวดเร็วของคุณไม่ได้มาจากความไม่คิด แต่มาจากความเชื่อมั่นอย่างเต็มเปี่ยมในความต้องการของตนเองในขณะนั้น",
           shadow: "การใช้ชีวิตตามแรงกระตุ้นเปรียบเหมือนการขับรถเร็วโดยไม่ดูแผนที่ คุณอาจไปถึงบางที่ได้เร็วกว่าคนอื่น แต่ก็มีโอกาสสูงที่จะหลงทางหรือน้ำมันหมดกลางทาง เงามืดที่แท้จริงคือ 'ผลลัพธ์' จากการกระทำในอดีตที่ไล่ตามคุณมาไม่หยุด ซึ่งอาจทำให้ชีวิตคุณกลายเป็นการแก้ปัญหาเฉพาะหน้าไปเรื่อยๆ โดยไม่ได้สร้างอะไรที่มั่นคงเลย",
           unlock: "พลังงานที่พลุ่งพล่านของคุณคือเชื้อเพลิงของ 'นวัตกรรม' ศิลปินและผู้ประกอบการที่ประสบความสำเร็จทุกคนล้วนมีความกล้าที่จะแตกต่างแบบคุณ ความท้าทายของคุณคือการเรียนรู้ที่จะควบคุมพายุในใจและกำหนดทิศทางให้มัน ลองเปลี่ยนจากการ 'ต่อต้าน' อย่างไร้เป้าหมาย มาเป็นการตั้งคำถามว่า 'เราจะสร้างระบบที่ดีกว่านี้ได้อย่างไร?' แล้วคุณจะไม่ได้เป็นแค่ผู้แหกกฎ แต่จะเป็น 'ผู้สร้างกฎใหม่' ให้กับวงการ"
       },
       sadist: {
           name: "The Inflictor of Pain",
           thaiName: "ผู้เสพติดความเจ็บปวด",
           scientificTerm: "Sadism",
           icon: "😈",
           quote: "อำนาจที่แท้จริง คือการได้เห็นความกลัวในสายตาคนอื่น",
           description: "แก่นแท้ของคุณไม่ได้อยู่ที่ความสุขจากความเจ็บปวดของคนอื่น แต่อยู่ที่ความสุขจากการได้ 'ยืนยันอำนาจ' ของตัวเอง การได้เห็นปฏิกิริยาตอบสนองทางอารมณ์ที่รุนแรงของผู้อื่น (ไม่ว่าจะเป็นความกลัว ความอับอาย หรือความเจ็บปวด) คือหลักฐานที่จับต้องได้ว่าคุณมี 'อิทธิพล' และสามารถ 'ควบคุม' สภาพแวดล้อมรอบตัวได้ มันคือการทดลองเพื่อดูว่าคุณสามารถผลักดันขีดจำกัดของคนอื่นไปได้ไกลแค่ไหน",
           shadow: "การยืนยันอำนาจในรูปแบบนี้เป็นสิ่งเสพติด คุณอาจต้องใช้การกระทำที่รุนแรงขึ้นเรื่อยๆ เพื่อให้ได้ความรู้สึกเดิมกลับมา และจะผลักไสทุกคนออกจากชีวิตจนหมดสิ้น สุดท้ายแล้วคุณจะไม่ได้ครองบัลลังก์แห่งอำนาจ แต่จะถูกขังอยู่ในคุกแห่งความโดดเดี่ยวที่ไม่มีใครกล้าเข้าใกล้ และสูญเสียความสามารถที่จะมีความสุขจากสิ่งอื่นใดในชีวิต",
           unlock: "ความปรารถนาในอำนาจและการควบคุมคือแรงผลักดันที่ทรงพลังที่สุด ลองเปลี่ยนสนามรบจากการควบคุม 'ผู้คน' มาเป็นการควบคุม 'สถานการณ์ที่ท้าทาย' แทน เช่น การแข่งขันทางธุรกิจที่ดุเดือด, การเล่นกีฬาที่ต้องใช้กลยุทธ์ขั้นสูง, หรือการทำงานที่ต้องเอาชนะอุปสรรคที่ยากมากๆ การได้ 'พิชิต' เป้าหมายที่ยิ่งใหญ่ จะมอบความรู้สึกถึงพลังอำนาจที่สมบูรณ์และได้รับการยอมรับอย่างยั่งยืนกว่า"
       },
       antisocial: {
           name: "The Rule Breaker",
           thaiName: "ผู้ละเมิดกฎเกณฑ์",
           scientificTerm: "Antisocial Personality",
           icon: "⛓️",
           quote: "ผมจะหยุดก็ต่อเมื่อผมอยากหยุด",
           description: "คุณมองโลกด้วยสายตาที่ปราศจากอุดมคติ คุณเชื่อว่าโดยพื้นฐานแล้วมนุษย์ทุกคนเห็นแก่ตัว คุณแค่เป็นคนเดียวที่ 'ซื่อสัตย์' ต่อความจริงข้อนี้ สำหรับคุณ ศีลธรรมและกฎหมายไม่ใช่สิ่งศักดิ์สิทธิ์ แต่เป็นเพียง 'ข้อตกลงทางสังคม' ที่สามารถเปลี่ยนแปลงหรือหาช่องโหว่ได้ คุณจึงไม่ลังเลที่จะทำในสิ่งที่คนอื่นไม่กล้า เพื่อให้ได้มาซึ่งสิ่งที่คุณต้องการในเวลาที่รวดเร็วที่สุด",
           shadow: "การใช้ชีวิตโดยไม่สนใจข้อตกลงใดๆ เลย เปรียบเหมือนการเล่นเกมโดยไม่สนใจกติกา คุณอาจชนะได้บ้างในระยะสั้น แต่ในที่สุดก็จะถูกไล่ออกจากเกมและไม่มีใครอยากร่วมเล่นด้วยอีก เงามืดที่น่ากลัวที่สุดคือการสูญเสีย 'ความน่าเชื่อถือ' ซึ่งเป็นรากฐานที่สำคัญที่สุดในการสร้างความสำเร็จที่ยิ่งใหญ่และมั่นคงในระยะยาว",
           unlock: "พรสวรรค์ของคุณคือการมองเห็น 'ช่องว่างและโอกาส' ที่คนอื่นมองไม่เห็นเพราะถูกจำกัดด้วยกรอบความคิดเดิมๆ คุณคือสุดยอดนักแก้ปัญหาเฉพาะหน้า ลองเปลี่ยนมุมมองจากการ 'ทำลายกฎ' เพื่อเอาตัวรอด เป็นการ 'ทำความเข้าใจกฎอย่างลึกซึ้ง' เพื่อใช้ให้เป็นประโยชน์ หากคุณสามารถผสานความกล้าของคุณเข้ากับวิสัยทัศน์ที่ยาวไกลขึ้นได้ คุณจะพบว่าอิสรภาพที่แท้จริงไม่ใช่การอยู่นอกกฎ แต่คือการสามารถสร้างกฎที่เอื้อประโยชน์ให้คุณได้อย่างชาญฉลาด"
       }
   };


   const questions = [
       { text: "ในการนำเสนอโปรเจกต์สำคัญ มีเพื่อนร่วมทีมคนหนึ่งกำลังจะทำให้การนำเสนอล้มเหลว คุณจะ", answers: [{ text: "ปล่อยให้เขาล้มเหลวไป แล้วชี้ให้หัวหน้าเห็นอย่างแนบเนียนว่าเป็นความผิดพลาดของเขาคนเดียว", scores: { machiavellian: 3, psychopath: 1 } }, { text: "เข้าไปควบคุมสถานการณ์และนำเสนอส่วนที่เหลือทั้งหมดด้วยตัวเอง เพื่อแสดงให้เห็นว่ามีเพียงคุณเท่านั้นที่พึ่งพาได้", scores: { narcissist: 3, machiavellian: 1 } }, { text: "รู้สึกสนุกเล็กน้อยที่ได้เห็นเขาตื่นตระหนกและลนลานอยู่บนเวที", scores: { sadist: 3, sociopath: 1 } }, { text: "พูดแทรกและแก้ไขข้อมูลที่ผิดพลาดทันที โดยไม่สนใจว่าเขาจะรู้สึกเสียหน้าหรือไม่", scores: { psychopath: 2, antisocial: 1, sociopath: 1 } }] },
       { text: "คุณค้นพบความลับที่สามารถทำลายชื่อเสียงของคู่แข่งคนสำคัญได้ คุณจะ", answers: [{ text: "เก็บข้อมูลไว้เป็นไพ่ตาย เพื่อใช้ต่อรองหรือทำลายเขาในจังหวะที่ได้ผลประโยชน์สูงสุด", scores: { machiavellian: 3, psychopath: 1 } }, { text: "ปล่อยข่าวลือออกไปทันที เพราะทนไม่ไหวที่จะเห็นเขาทุกข์ทรมาน", scores: { sadist: 3, sociopath: 2 } }, { text: "ไม่ทำอะไรเลย เพราะเรื่องของเขาไม่ใช่ธุระและไม่ส่งผลต่อเป้าหมายของคุณ", scores: { psychopath: 3, machiavellian: 1 } }, { text: "ใช้ความลับนี้เพื่อทำให้ทุกคนเห็นว่าคุณเหนือกว่าและรู้ลึกกว่าเขาเสมอ", scores: { narcissist: 3, machiavellian: 1 } }] },
       { text: "คุณได้รับมอบหมายให้ทำงานร่วมกับคนที่ไม่ชอบหน้า แต่โปรเจกต์นี้จะทำให้คุณได้หน้าอย่างมาก คุณจะ", answers: [{ text: "มอบหมายงานที่น่าเบื่อและยากที่สุดให้เขาทำ แล้วคุณค่อยนำผลงานทั้งหมดไปเสนอเป็นความดีความชอบของตัวเอง", scores: { machiavellian: 3, narcissist: 1, psychopath: 1 } }, { text: "ทำงานร่วมกับเขาโดยไม่แสดงอารมณ์ใดๆ เหมือนเขาเป็นเพียงเครื่องมือชิ้นหนึ่งในการทำงาน", scores: { psychopath: 3 } }, { text: "บอกคนอื่นๆ ตลอดเวลาว่าคุณต้องทำงานหนักแค่ไหนที่ต้องมาแบกคนไร้ความสามารถแบบนี้", scores: { narcissist: 3 } }, { text: "หาเรื่องแกล้งหรือขัดขวางการทำงานของเขาเล็กๆ น้อยๆ เพื่อความสะใจส่วนตัว", scores: { sadist: 3, sociopath: 1, antisocial: 1 } }] },
       { text: "ถ้าคุณสามารถทำผิดกฎหมายร้ายแรงได้ 1 อย่างโดยไม่มีใครจับได้เด็ดขาด คุณจะเลือกทำอะไร", answers: [{ text: "แฮ็กเข้าระบบธนาคารเพื่อโอนเงินจำนวนมหาศาลเข้าบัญชีตัวเอง", scores: { antisocial: 3, machiavellian: 2, psychopath: 1 } }, { text: "สร้างเหตุการณ์ปั่นป่วนในสังคมเพื่อให้เกิดความโกลาหลครั้งใหญ่", scores: { sociopath: 3, sadist: 2, antisocial: 1 } }, { text: "ลบข้อมูลประวัติของคนที่คุณเกลียดออกจากทุกระบบบนโลก", scores: { sadist: 3, machiavellian: 1, antisocial: 1 } }, { text: "ไม่ทำอะไรเลย เพราะการทำผิดกฎหมายมีความเสี่ยงและไม่คุ้มค่า", scores: { psychopath: 3 } }] },
       { text: "เพื่อนสนิทมาขอคำปรึกษาเรื่องปัญหาชีวิตที่น่าเบื่อและซ้ำซาก คุณจะ", answers: [{ text: "แสร้งทำเป็นรับฟังอย่างเห็นอกเห็นใจ เพราะการรักษาความสัมพันธ์นี้มีประโยชน์กับคุณ", scores: { machiavellian: 3, psychopath: 1 } }, { text: "บอกความจริงที่เจ็บปวดตรงๆ ว่าปัญหาทั้งหมดเกิดจากตัวเพื่อนเอง", scores: { sadist: 2, antisocial: 2 } }, { text: "ไม่เข้าใจว่าทำไมเขาต้องรู้สึกอะไรมากมายกับเรื่องแค่นี้", scores: { psychopath: 3 } }, { text: "เปลี่ยนเรื่องคุยเป็นเรื่องของคุณที่น่าสนใจกว่า", scores: { narcissist: 3 } }] },
       { text: "มีคนวิจารณ์คุณอย่างรุนแรงบนโซเชียลมีเดีย คุณจะ", answers: [{ text: "ไม่สนใจ เพราะความเห็นของคนอื่นไม่มีค่าสำหรับคุณ", scores: { psychopath: 3, narcissist: 1 } }, { text: "โจมตีกลับด้วยข้อมูลส่วนตัวของเขาที่ไปขุดคุ้ยมา", scores: { sociopath: 3, sadist: 2, antisocial: 1 } }, { text: "ตอบกลับอย่างสุภาพแต่เชือดเฉือน เพื่อให้ผู้ติดตามของคุณเห็นว่าคุณฉลาดกว่า", scores: { narcissist: 3, machiavellian: 2 } }, { text: "ปล่อยให้ผู้ติดตามที่ภักดีของคุณเข้าไปจัดการถล่มเขาแทน", scores: { narcissist: 3 } }] },
       { text: "คุณอยู่ในทีมกู้ภัยหลังเกิดภัยพิบัติ ทรัพยากรมีจำกัด คุณจะ", answers: [{ text: "จัดสรรทรัพยากรให้เฉพาะคนที่มีโอกาสรอดสูงสุด แม้จะดูไร้หัวใจ", scores: { psychopath: 3, machiavellian: 2 } }, { text: "เสนอตัวเป็นผู้นำในการแจกจ่าย เพื่อควบคุมสถานการณ์และได้รับเครดิต", scores: { narcissist: 3, machiavellian: 1 } }, { text: "แอบเก็บทรัพยากรส่วนหนึ่งไว้เพื่อตัวเองก่อน", scores: { antisocial: 3, narcissist: 1 } }, { text: "ใช้กำลังหรือข่มขู่เพื่อแย่งชิงทรัพยากรมาให้ได้มากที่สุด", scores: { sociopath: 3, sadist: 1, antisocial: 1 } }] },
       { text: "เจ้านายชมเชยผลงานของคุณ ซึ่งจริงๆ แล้วเพื่อนร่วมงานเป็นคนช่วยทำส่วนใหญ่ คุณจะ", answers: [{ text: "รับคำชมไว้ทั้งหมด เพราะท้ายที่สุดคุณคือคนรับผิดชอบโปรเจกต์", scores: { machiavellian: 3, narcissist: 2 } }, { text: "บอกเจ้านายว่าคุณสุดยอดแค่ไหนที่สามารถนำทีมจนทำโปรเจกต์นี้สำเร็จได้", scores: { narcissist: 3 } }, { text: "ไม่รู้สึกอะไร เพราะคำชมของเจ้านายเป็นเพียงสิ่งที่คาดหวังอยู่แล้ว", scores: { psychopath: 3 } }, { text: "กล่าวขอบคุณเพื่อนร่วมทีมพอเป็นพิธี แต่จะเน้นย้ำว่าไอเดียหลักเป็นของคุณ", scores: { narcissist: 3, machiavellian: 1 } }] },
       { text: "สิ่งที่ทำให้คุณรู้สึก \"มีชีวิตชีวา\" มากที่สุดคือ", answers: [{ text: "การได้เอาชนะคู่แข่งที่ทัดเทียมกัน", scores: { sadist: 2, narcissist: 1, machiavellian: 1 } }, { text: "การได้รับการยอมรับและชื่นชมจากคนจำนวนมาก", scores: { narcissist: 3 } }, { text: "การที่แผนการอันซับซ้อนของคุณประสบความสำเร็จ", scores: { machiavellian: 3, psychopath: 2 } }, { text: "ความรู้สึกตื่นเต้นจากการทำอะไรเสี่ยงๆ หรือผิดกฎเกณฑ์", scores: { sociopath: 3, antisocial: 2 } }] },
       { text: "เป้าหมายสูงสุดในชีวิตของคุณคือ", answers: [{ text: "การมีอำนาจและอิทธิพลเหนือคนอื่น", scores: { psychopath: 3, machiavellian: 1, narcissist: 1 } }, { text: "การได้รับการยอมรับว่าเป็นที่สุดในสิ่งที่คุณทำ", scores: { narcissist: 3 } }, { text: "การใช้ชีวิตอย่างอิสระโดยไม่มีกฎเกณฑ์หรือใครมาผูกมัด", scores: { antisocial: 3, sociopath: 3 } }, { text: "การบรรลุเป้าหมายที่ตั้งไว้ ไม่ว่าจะต้องแลกกับอะไรก็ตาม", scores: { machiavellian: 3, psychopath: 1 } }] },
       { text: "\"ความยุติธรรม\" ในความคิดของคุณคือ", answers: [{ text: "กฎเกณฑ์ที่คนอ่อนแอสร้างขึ้นเพื่อปกป้องตัวเองจากคนที่แข็งแกร่งกว่า", scores: { psychopath: 2, sociopath: 1, antisocial: 2 } }, { text: "สิ่งที่สามารถบิดเบือนได้เพื่อประโยชน์ของฝ่ายที่ฉลาดกว่า", scores: { machiavellian: 3, psychopath: 1 } }, { text: "ผลลัพธ์ที่เอื้อประโยชน์ให้แก่คุณและพวกพ้องของคุณมากที่สุด", scores: { narcissist: 3, antisocial: 1 } }, { text: "แนวคิดในอุดมคติที่ไม่มีอยู่จริงในโลกแห่งความเป็นจริง", scores: { psychopath: 3 } }] },
       { text: "ถ้าการหักหลังคน 1 คน จะช่วยให้คนอีก 10 คนรอดชีวิต คุณจะตัดสินใจอย่างไร", answers: [{ text: "หักหลังคนๆ นั้นโดยไม่ลังเล เพราะผลประโยชน์ของส่วนรวมสำคัญกว่า", scores: { psychopath: 3, machiavellian: 2 } }, { text: "ไม่ทำอะไรเลย เพราะคุณไม่ต้องการเข้าไปยุ่งเกี่ยวกับสถานการณ์ที่ซับซ้อน", scores: { psychopath: 3, antisocial: 1 } }, { text: "หาทางหลอกใช้คนๆ นั้นให้สละตัวเอง โดยที่เขาไม่รู้ตัวว่าถูกหักหลัง", scores: { machiavellian: 3, psychopath: 1 } }, { text: "การตัดสินใจขึ้นอยู่กับว่าคน 1 คนนั้น และคนอีก 10 คนนั้น มีประโยชน์กับคุณมากน้อยแค่ไหน", scores: { psychopath: 2, narcissist: 2, machiavellian: 2 } }] }
   ];


   // --- STATE VARIABLES ---
   let currentQuestionIndex = 0;
   let userAnswers = [];
  
   // --- DOM ELEMENTS ---
   const startSection = document.getElementById('startSection');
   const quizSection = document.getElementById('quizSection');
   const resultsSection = document.getElementById('resultsSection');
   const startBtn = document.getElementById('startTestBtn');
   const questionContainer = document.getElementById('questionContainer');
   const progressText = document.getElementById('progressText');
   const progressBar = document.getElementById('progressBar');
   const resultsContainer = document.getElementById('resultsContainer');
   const bgMystery = document.getElementById('bgMystery');
  
   // --- FUNCTIONS ---


   /**
    * Shuffles an array in place.
    * @param {Array} array The array to shuffle.
    * @returns {Array} The shuffled array.
    */
   function shuffleArray(array) {
       for (let i = array.length - 1; i > 0; i--) {
           const j = Math.floor(Math.random() * (i + 1));
           [array[i], array[j]] = [array[j], array[i]];
       }
       return array;
   }


   /**
    * Creates animated background particles.
    */
   function createMysteriousParticles() {
       if (!bgMystery || bgMystery.children.length > 0) return;
       const particleCount = window.innerWidth < 768 ? 20 : 40;
       for (let i = 0; i < particleCount; i++) {
           const particle = document.createElement('div');
           particle.className = 'mystery-particle';
           particle.style.left = `${Math.random() * 100}%`;
           particle.style.top = `${Math.random() * 100}%`;
           const size = Math.random() * 6 + 2;
           particle.style.width = `${size}px`;
           particle.style.height = `${size}px`;
           particle.style.animationDelay = `${Math.random() * 12}s`;
           particle.style.animationDuration = `${Math.random() * 8 + 8}s`;
           bgMystery.appendChild(particle);
       }
   }


   /**
    * Starts the test.
    */
   function startTest() {
       startSection.style.display = 'none';
       const startDisclaimer = document.getElementById('disclaimerFooter');
       if (startDisclaimer) startDisclaimer.style.display = 'none';
      
       resultsSection.style.display = 'none';
       quizSection.style.display = 'block';
      
       currentQuestionIndex = 0;
       userAnswers = new Array(questions.length).fill(null);
      
       displayQuestion();
   }


   /**
    * Displays the current question and its shuffled answers.
    */
   function displayQuestion() {
       if (currentQuestionIndex >= questions.length) return;


       const question = questions[currentQuestionIndex];
       const shuffledAnswers = shuffleArray([...question.answers]);


       questionContainer.innerHTML = `
           <div class="question-card" id="currentQuestionCard">
               <div class="question-number">คำถามข้อที่ ${currentQuestionIndex + 1} / ${questions.length}</div>
               <div class="question-text">${question.text}</div>
               <div class="answers-grid">
                   ${shuffledAnswers.map(answer => `
                       <div class="answer-option" role="button" tabindex="0" data-text="${answer.text.replace(/"/g, '&quot;')}">
                           ${answer.text}
                       </div>
                   `).join('')}
               </div>
               <nav class="quiz-navigation" id="quizNavigation">
                   <button class="btn btn-secondary" id="prevBtn">← ย้อนกลับ</button>
                   <button class="btn btn-danger" id="nextBtn">ต่อไป →</button>
               </nav>
           </div>
       `;
      
       const answerOptions = questionContainer.querySelectorAll('.answer-option');
       answerOptions.forEach((option) => {
           const answerText = option.dataset.text;
           const answerObject = shuffledAnswers.find(a => a.text === answerText);
           option.addEventListener('click', () => selectAnswer(option, answerObject));
       });
      
       // Restore selection if exists
       const selectedAnswer = userAnswers[currentQuestionIndex];
       if (selectedAnswer) {
           answerOptions.forEach(option => {
               if (option.dataset.text === selectedAnswer.text) {
                   option.classList.add('selected');
               }
           });
       }
      
       document.getElementById('prevBtn').addEventListener('click', handlePrevButtonClick);
       document.getElementById('nextBtn').addEventListener('click', handleNextButtonClick);


       updateNavigation();
   }


   /**
    * Handles answer selection and updates UI.
    * @param {HTMLElement} selectedOption The clicked HTML element.
    * @param {object} selectedAnswer The chosen answer object.
    */
   function selectAnswer(selectedOption, selectedAnswer) {
       userAnswers[currentQuestionIndex] = selectedAnswer;
       questionContainer.querySelectorAll('.answer-option').forEach(opt => opt.classList.remove('selected'));
       selectedOption.classList.add('selected');
       updateNavigation();
   }


   function handleNextButtonClick() {
       if (userAnswers[currentQuestionIndex] === null) return;
      
       const card = document.getElementById('currentQuestionCard');
       if (currentQuestionIndex < questions.length - 1) {
           if (card) {
               card.style.animation = 'questionDarkFadeOut 0.4s ease-out forwards';
               card.addEventListener('animationend', () => {
                   currentQuestionIndex++;
                   displayQuestion();
               }, { once: true });
           }
       } else {
           showResults();
       }
   }


   function handlePrevButtonClick() {
       if (currentQuestionIndex > 0) {
           const card = document.getElementById('currentQuestionCard');
           if (card) {
               card.style.animation = 'questionDarkFadeOut 0.4s ease-out forwards';
               card.addEventListener('animationend', () => {
                   currentQuestionIndex--;
                   displayQuestion();
               }, { once: true });
           }
       }
   }
  
   /**
    * Updates the progress bar and navigation buttons.
    */
   function updateNavigation() {
       const percentage = ((currentQuestionIndex + 1) / questions.length) * 100;
       progressBar.style.width = `${percentage}%`;
       progressText.textContent = `ความคืบหน้า: ${currentQuestionIndex + 1} / ${questions.length}`;


       const nextBtn = document.getElementById('nextBtn');
       const prevBtn = document.getElementById('prevBtn');


       if(prevBtn) prevBtn.disabled = currentQuestionIndex === 0;
       if(nextBtn) {
           nextBtn.disabled = userAnswers[currentQuestionIndex] === null;
           nextBtn.innerHTML = (currentQuestionIndex === questions.length - 1) ? 'ดูผลลัพธ์ 🔮' : 'ต่อไป →';
       }
   }


   /**
    * Calculates raw scores from user answers.
    * @returns {object} An object with total raw scores for each archetype.
    */
   function calculateRawScores() {
       const scores = Object.keys(archetypesData).reduce((acc, key) => ({ ...acc, [key]: 0 }), {});
       userAnswers.forEach(answer => {
           if (answer && answer.scores) {
               for (const archetype in answer.scores) {
                   if (scores.hasOwnProperty(archetype)) {
                       scores[archetype] += answer.scores[archetype];
                   }
               }
           }
       });
       return scores;
   }
  
   /**
   * Normalizes and sorts scores based on distribution.
   * @param {object} rawScores The object with raw scores.
   * @returns {Array} A sorted array of [key, percentage] pairs.
   */
   function calculateDistributionAndSort(rawScores) {
       const totalRawScore = Object.values(rawScores).reduce((sum, score) => sum + score, 0);
      
       if (totalRawScore === 0) {
           return Object.keys(rawScores).map(key => [key, 0]);
       }


       const distributionScores = {};
       for (const key in rawScores) {
           if (rawScores.hasOwnProperty(key)) {
               distributionScores[key] = Math.round((rawScores[key] / totalRawScore) * 100);
           }
       }
       return Object.entries(distributionScores).sort(([, a], [, b]) => b - a);
   }




   /**
    * Shows the final results page.
    */
   function showResults() {
       quizSection.style.display = 'none';
       resultsSection.style.display = 'block';
      
       window.scrollTo({ top: 0, behavior: 'smooth' });


       const finalRawScores = calculateRawScores();
       const sortedDistributionScores = calculateDistributionAndSort(finalRawScores);
      
       const primaryArchetypeKey = sortedDistributionScores[0][0];
       const primaryArchetypeData = archetypesData[primaryArchetypeKey];


       resultsContainer.innerHTML = createArchetypeCard(primaryArchetypeData);


       const retakeBtn = document.getElementById('retakeBtn');
       if(retakeBtn) {
           retakeBtn.addEventListener('click', resetTest);
       }


       renderPowerBars(sortedDistributionScores);
   }
  
   /**
    * Creates HTML for the primary archetype result card.
    * @param {object} archetype The data for the archetype.
    * @returns {string} The HTML string for the card.
    */
   function createArchetypeCard(archetype) {
       return `
           <div class="archetype-card primary">
               <h3 class="archetype-title">${archetype.thaiName}</h3>
               <div class="archetype-classification">พื้นฐานทางจิตวิทยา ${archetype.scientificTerm}</div>
               <p class="archetype-subtitle">"${archetype.quote}"</p>
              
               <div class="archetype-description-section">
                   <h3>บทวิเคราะห์เชิงลึก</h3>
                   <p>${archetype.description}</p>
                  
                   <h3>ด้านมืดที่ต้องระวัง</h3>
                   <p>${archetype.shadow}</p>
                  
                   <h3>ปลดล็อกศักยภาพที่แท้จริง</h3>
                   <p>${archetype.unlock}</p>
               </div>
              
               <div class="call-to-action">
                   <h3>สนใจที่จะกลายเป็นคน<br><span class="cta-highlight">อ่านทะลุสันดานคนอื่น</span>?</h3>
                   <p style="opacity:0.9; font-size: 0.95rem; line-height: 1.7;">เพื่อเปลี่ยนตัวเองให้เป็นคนที่<br>ได้เปรียบทุกคนในทุกสถานการณ์<br>และเป็น <span class="cta-special">🔥 69 คนแรก</span><br>ที่ได้รับสิทธิพิเศษจากเบบี้</p>
                   <button class="btn btn-danger" style="margin-top: 16px;" onclick="window.open('https://roothalukhon.framer.website/', '_blank')">คลิกเลย</button>
               </div>
           </div>
       `;
   }


   /**
    * Renders the power bars visualization.
    * @param {Array} sortedScores A sorted array of [key, percentage] pairs.
    */
   function renderPowerBars(sortedScores) {
       const container = document.getElementById('powerBarsContent');
       container.innerHTML = ''; // Clear previous bars


       sortedScores.forEach(([key, percentage], index) => {
           const archetypeInfo = archetypesData[key];
          
           const barWrapper = document.createElement('div');
           barWrapper.className = 'power-bar-wrapper';
           barWrapper.style.animationDelay = `${index * 120}ms`;
          
           barWrapper.innerHTML = `
               <div class="power-bar-info">
                   <div class="power-bar-label">
                        <div class="power-bar-main-label">
                           <span class="power-bar-icon">${archetypeInfo.icon}</span>
                           <span>${archetypeInfo.scientificTerm}</span>
                       </div>
                       <div class="power-bar-thai-name">${archetypeInfo.thaiName}</div>
                   </div>
                   <span class="power-bar-value">${percentage}%</span>
               </div>
               <div class="power-bar-bg">
                   <div class="power-bar-fill" style="width: 0%;"></div>
               </div>
           `;
           container.appendChild(barWrapper);


           // Trigger animation after element is in the DOM
           setTimeout(() => {
               const fill = barWrapper.querySelector('.power-bar-fill');
               if (fill) {
                   fill.style.width = `${percentage}%`;
               }
           }, 100);
       });
   }




   /**
    * Resets the entire test to the start screen.
    */
   function resetTest() {
       resultsSection.style.display = 'none';
       quizSection.style.display = 'none';
      
       let disclaimer = document.getElementById('disclaimerFooter');
       disclaimer.style.display = 'block';
       startSection.style.display = 'block';


       window.scrollTo({ top: 0, behavior: 'smooth' });
   }


   // --- INITIALIZATION ---
   createMysteriousParticles();
  
   // Setup the disclaimer content
   const disclaimerContent = `<p><strong>คำเตือน:</strong> แบบทดสอบนี้จัดทำเพื่อความบันเทิงและการสำรวจตนเองเบื้องต้นเท่านั้น<br>ไม่สามารถใช้ในการวินิจฉัยทางการแพทย์ได้</p>`;
   document.getElementById('disclaimerFooter').innerHTML = disclaimerContent;


   // Add main button event listener
   startBtn.addEventListener('click', startTest);
  
   // Use event delegation for the retake button
   const mainContainer = document.getElementById('container');
   mainContainer.addEventListener('click', function(event) {
       if (event.target && event.target.id === 'retakeBtn') {
           resetTest();
       }
   });


});
</script>


</body>
</html>